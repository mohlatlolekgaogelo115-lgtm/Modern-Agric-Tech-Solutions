<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TerraScout | Global & Local Soil Explorer</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* Modern CSS Reset and Variables */
        :root {
            --primary: #2ecc71;
            --secondary: #27ae60;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --text: #333;
            --panel-bg: rgba(255, 255, 255, 0.95);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            color: var(--text);
            overflow: hidden; /* Keep it app-like */
        }

        /* Navbar */
        nav {
            background: var(--dark);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1000;
        }

        nav h1 {
            font-weight: 800;
            letter-spacing: 1px;
            color: var(--primary);
        }

        /* Main App Container */
        .app-container {
            display: flex;
            height: calc(100vh - 60px);
            position: relative;
        }

        /* The Interactive Map */
        #map {
            flex-grow: 1;
            height: 100%;
            z-index: 1;
        }

        /* UI Overlays & Instructions */
        .map-overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            z-index: 500;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
            cursor: pointer;
        }

        /* Instant Report Sidebar (Animated) */
        .report-panel {
            position: absolute;
            top: 0;
            right: -400px; /* Hidden by default */
            width: 380px;
            height: 100%;
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: -5px 0 25px rgba(0,0,0,0.1);
            transition: right 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            padding: 2rem;
            overflow-y: auto;
        }

        .report-panel.active {
            right: 0;
        }

        .close-btn {
            float: right;
            cursor: pointer;
            font-size: 1.5rem;
            color: #999;
            border: none;
            background: none;
            transition: color 0.3s ease;
        }

        .close-btn:hover { color: var(--dark); }

        .report-header {
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 0.5rem;
        }

        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .data-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
        }

        /* Animation classes triggered via JS */
        .data-card.show {
            opacity: 1;
            transform: translateY(0);
        }

        .data-card h3 {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .data-card .value {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary);
        }

        /* CSS Animations */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }

    </style>
</head>
<body>

    <nav>
        <h1>ðŸŒ± TerraScout</h1>
        <div>
            <span style="margin-right: 15px;">Global & Local Soil Explorer</span>
            <button style="padding: 5px 15px; border-radius: 20px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: bold;">API Docs</button>
        </div>
    </nav>

    <div class="app-container">
        <div id="map"></div>
        <div class="map-overlay">Click anywhere on the map to generate an instant soil report</div>

        <div class="report-panel" id="reportPanel">
            <button class="close-btn" onclick="closeReport()">&times;</button>
            <div class="report-header">
                <h2>Instant Soil Report</h2>
                <p id="coord-display" style="font-size: 0.8rem; color: #666; margin-top: 5px;">Coords: --</p>
            </div>

            <div class="data-grid" id="dataGrid">
                </div>
            
            <button style="width: 100%; margin-top: 20px; padding: 10px; background: var(--dark); color: white; border: none; border-radius: 5px; cursor: pointer;">Download Full PDF</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. Initialize the Map (Centered roughly on South Africa as requested)
        const map = L.map('map').setView([-28.4793, 24.6727], 6);

        // 2. Base Layers (Simulating standard and satellite views)
        const streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        });

        const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles Â© Esri'
        });

        streetLayer.addTo(map);

        // Simulated Weather/Rainfall Overlay (just a tinted placeholder layer for demo)
        const rainfallOverlay = L.tileLayer('https://{s}.tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=YOUR_API_KEY', {
            opacity: 0.5
        });

        // Layer Controls
        const baseMaps = {
            "Standard Map": streetLayer,
            "Satellite Imagery": satelliteLayer
        };
        const overlayMaps = {
            "Rainfall Patterns (Mock)": rainfallOverlay
        };
        L.control.layers(baseMaps, overlayMaps).addTo(map);

        let currentMarker = null;

        // 3. Map Click Event -> Generate Report
        map.on('click', function(e) {
            const lat = e.latlng.lat.toFixed(4);
            const lng = e.latlng.lng.toFixed(4);

            // Add a marker with a pop animation
            if(currentMarker) map.removeLayer(currentMarker);
            currentMarker = L.marker([lat, lng]).addTo(map);

            // Update UI
            document.getElementById('coord-display').innerText = `Lat: ${lat}, Lng: ${lng}`;
            openReport();
            generateMockData();
        });

        // UI Functions
        const panel = document.getElementById('reportPanel');
        function openReport() {
            panel.classList.add('active');
        }
        function closeReport() {
            panel.classList.remove('active');
        }

        // Simulate fetching data from your PostGIS/SoilGrids API
        function generateMockData() {
            const grid = document.getElementById('dataGrid');
            grid.innerHTML = ''; // Clear previous

            // Simulated Soil Data
            const soilData = [
                { label: 'Soil Texture', value: 'Sandy Loam' },
                { label: 'pH Level', value: (Math.random() * (8.0 - 5.5) + 5.5).toFixed(1) },
                { label: 'Organic Matter', value: (Math.random() * 5 + 1).toFixed(1) + '%' },
                { label: 'Nitrogen (N)', value: Math.floor(Math.random() * 50 + 10) + ' mg/kg' },
                { label: 'Water Holding', value: 'Medium' },
                { label: 'Erosion Risk', value: Math.random() > 0.5 ? 'Low' : 'Moderate' }
            ];

            // Render cards with staggered fade-in animation
            soilData.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'data-card';
                card.innerHTML = `
                    <h3>${item.label}</h3>
                    <div class="value">${item.value}</div>
                `;
                grid.appendChild(card);

                // Staggered animation trigger
                setTimeout(() => {
                    card.classList.add('show');
                }, 100 * index);
            });
        }
    </script>
</body>
</html>
